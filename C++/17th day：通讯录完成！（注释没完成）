#include <iostream>   // æ ‡å‡†è¾“å…¥è¾“å‡ºæµï¼šcoutï¼ˆæ‰“å°èœå•ã€æç¤ºä¿¡æ¯ï¼‰ã€cinï¼ˆè¯»å–ç”¨æˆ·é€‰æ‹©ã€è¾“å…¥æ•°æ®ï¼‰ã€endlï¼ˆæ¢è¡Œï¼‰
#include <vector>     // åŠ¨æ€æ•°ç»„å®¹å™¨ï¼švector<Contact>ï¼ˆå­˜å‚¨æ‰€æœ‰è”ç³»äººï¼‰ã€vector<int>ï¼ˆå­˜å‚¨åŒ¹é…è”ç³»äººç´¢å¼•ã€å¾…åˆ é™¤ç´¢å¼•ï¼‰
#include <string>     // å­—ç¬¦ä¸²ç±»ï¼šstringï¼ˆå§“åã€æ€§åˆ«ã€ç”Ÿæ—¥ç­‰å­—ç¬¦ä¸²å˜é‡ï¼‰ã€getlineï¼ˆè¯»å–æ•´è¡Œè¾“å…¥ï¼Œå¦‚è”ç³»äººå§“åã€åœ°å€ï¼‰
#include <regex>      // æ­£åˆ™è¡¨è¾¾å¼ï¼šregexï¼ˆå®šä¹‰ç”Ÿæ—¥æ ¼å¼æ­£åˆ™è§„åˆ™ï¼‰ã€regex_matchï¼ˆéªŒè¯ç”Ÿæ—¥å­—ç¬¦ä¸²æ˜¯å¦ç¬¦åˆæ ¼å¼ï¼‰
#include <cstring>    // Cé£æ ¼å­—ç¬¦ä¸²å¤„ç†ï¼šsscanfï¼ˆä»ç”Ÿæ—¥å­—ç¬¦ä¸²ä¸­è§£æå¹´ã€æœˆã€æ—¥ï¼‰
#include <windows.h>  // Windows APIï¼šSetConsoleOutputCPã€SetConsoleCPï¼ˆè®¾ç½®æ§åˆ¶å°ç¼–ç ä¸ºUTF-8ï¼Œæ”¯æŒä¸­æ–‡è¾“å…¥è¾“å‡ºï¼‰
#include <algorithm>  // ç®—æ³•åº“ï¼šsortï¼ˆå¯¹åˆ é™¤ç´¢å¼•æ’åºï¼Œé¿å…åˆ é™¤æ—¶ç´¢å¼•å¤±æ•ˆï¼‰ã€findï¼ˆæŸ¥æ‰¾ç”¨æˆ·è¾“å…¥çš„åºå·æ˜¯å¦æœ‰æ•ˆï¼‰
#include <cctype>     // å­—ç¬¦åˆ†ç±»ï¼šisdigitï¼ˆåˆ¤æ–­ç”µè¯å·ç å­—ç¬¦æ˜¯å¦ä¸ºæ•°å­—ï¼ŒéªŒè¯æ‰‹æœºå·æ ¼å¼ï¼‰
#include <limits>     // ä¸ºäº†ä½¿ç”¨ numeric_limits<streamsize>::max()ï¼Œåœ¨æ¸…ç©ºè¾“å…¥ç¼“å†²åŒºæ—¶éœ€è¦
using namespace std;

//å°†ç»ˆç«¯çš„ç¼–ç è½¬æ¢ä¸ºèƒ½è¾“å…¥å’Œè¾“å‡ºä¸­æ–‡çš„æ ¼å¼
void setConsoleUTF8(){
    #ifdef _win32
    SetConsoleOutputCP(65001);
    SetConsoleCP(65001);
    #endif
}

//inputå‡½æ•°ï¼šè¾“å‡ºæ–‡å­—çš„åŒæ—¶è¾“å…¥ï¼Œä¸Pythoné‡Œçš„inputå‡½æ•°åŠŸèƒ½ä¸€è‡´
string input(const string& str){
    string inf;
    cout << str;
    cin >> inf;
    cin.ignore();
    return inf;
}

//åˆ¤æ–­æ€§åˆ«è¾“å…¥
bool isGender(const string &g){ return g == "ç”·" || g == "å¥³"; }
//åˆ¤æ–­ç”Ÿæ—¥è¾“å…¥
bool isBirthday(const string &b) {
    regex pattern(R"(^ \d{4}[-/.] \d{2,1}\1 \d{2,1} &)");/*æ­£åˆ™è¡¨è¾¾å¼regex*/
    /*  
        ^             - åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹
        \d{4}         - åŒ¹é… exactly 4 ä¸ªæ•°å­—ï¼ˆä¾‹å¦‚ï¼š2023ï¼‰
        ([-.\/])      - åŒ¹é…ä¸€ä¸ªåˆ†éš”ç¬¦ï¼ˆ'-', '.', æˆ– '/'ï¼‰ï¼Œå¹¶å°†å…¶ä½œä¸ºç¬¬ä¸€ä¸ªæ•è·ç»„
        \d{1,2}       - åŒ¹é… 1 ä¸ªæˆ– 2 ä¸ªæ•°å­—ï¼ˆä¾‹å¦‚ï¼š9 æˆ– 12ï¼‰
        \1            - åå‘å¼•ç”¨ï¼Œå¿…é¡»ä¸ç¬¬ä¸€ä¸ªæ•è·ç»„åŒ¹é…çš„åˆ†éš”ç¬¦ç›¸åŒ
        \d{1,2}       - åŒ¹é… 1 ä¸ªæˆ– 2 ä¸ªæ•°å­—ï¼ˆä¾‹å¦‚ï¼š5 æˆ– 28ï¼‰
        $             - åŒ¹é…å­—ç¬¦ä¸²çš„ç»“å°¾
    */
    if (!regex_match(b, pattern)){
        /*åˆ¤æ–­æ˜¯å¦æ»¡è¶³æ­£åˆ™è¡¨è¾¾å¼è¦æ±‚çš„æ ¼å¼ï¼Œbæ˜¯è¢«æ£€æŸ¥å­—ç¬¦ä¸²ï¼Œpatternæ˜¯è¡¨è¾¾å¼æ ¼å¼çš„å‘½å*/
        return false;
    }

    int year, month, day;//ä¸ºäº†å°†å¹´æœˆæ—¥å’Œåˆ†éš”ç¬¦æå–å‡ºæ¥
    char sep1, sep2;     //è¿™é‡Œåˆ†åˆ«å®šä¹‰ä¸€ä¸ªå˜é‡ä½œä¸ºå®¹å™¨æ¥æ¥æ”¶å®ƒ
    sscanf(b.c_str(), "%d%c%d%c%d", &year, &sep1, &month, &sep2, &day);
    /*
        b.c_strå°†cppé£æ ¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºCè¯­è¨€é£æ ¼çš„å­—ç¬¦ä¸²
        è§£ææ ¼å¼ï¼šæ•´æ•°(å¹´)+å­—ç¬¦(åˆ†éš”ç¬¦1)+æ•´æ•°(æœˆ)+å­—ç¬¦(åˆ†éš”ç¬¦2)+æ•´æ•°(æ—¥)  psï¼š%dè·å–ä¸€ä¸ªåè¿›åˆ¶æ•´æ•°ï¼Œ%cè·å–ä¸€ä¸ªå­—ç¬¦
        å°†æ¯ä¸ª%dæˆ–è€…%cè·å¾—åˆ°çš„å€¼åˆ†åˆ«ä¼ å…¥å¯¹åº”å˜é‡
    */
    if (month > 12 || month < 1) return false;//æ£€æŸ¥æ—¥æœŸèŒƒå›´
    if (day < 1 || day > 31) return false;
    return true;
}
//åˆ¤æ–­å·ç è¾“å…¥
bool isPhone(const string &p){
    //æ£€æŸ¥é•¿åº¦
    if (p.size() != 11){
        return false;
    }
    //æ£€æŸ¥æ˜¯å¦ä¸ºæ•°å­—
    for (char c: p){
        if (!isdigit(c)){
            return false;
        }
    }
    return true;
}
//åˆ¤æ–­çŸ­å·è¾“å…¥
bool isShort(const string& s){
    bool isValid = false;//åˆ¤æ–­çŸ­å·æ˜¯å¦ç¬¦åˆè§„å®š
    try {                                               //tryï¼šç‰¹æ®Šä»£ç å—æ ‡è®°
        stoi(s);//stoiåœ¨é‡åˆ°éæ•°å­—å­—ç¬¦æ—¶å°±ä¼šæŠ›å‡ºå¼‚å¸¸       åœ¨å…¶{å¤§æ‹¬å·}å†…éƒ¨è¿è¡Œçš„ä»£ç ï¼Œç›¸å…³å‡½æ•°ä¼šé€šè¿‡â€˜throwâ€™å…³é”®å­—æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸
        if (s.size() == 3) isValid = true;         //æŠ›å‡ºå¼‚å¸¸åä»£ç å°†ä¼šè¿›å…¥catchéƒ¨åˆ†
    }
    //throwæŠ›å‡ºçš„å¼‚å¸¸ç±»å‹è‹¥ä¸catch()å†…çš„å¼‚å¸¸ç±»å‹ç›¸åŒ¹é…ï¼Œç¨‹åºåˆ™ä¼šè·³è½¬åˆ°æ­¤å¤„
    catch(const invalid_argument&/*æ­¤å¤„çš„å¼‚å¸¸ç±»å‹å°±æ˜¯å¯¹åº”stoiå‡½æ•°æŠ›å‡ºçš„å¼‚å¸¸*/) {
        isValid = false;
    }/*æ­¤å¤„å¯å†™catch(...)æ¥æ•è·æ‰€æœ‰å¼‚å¸¸ç±»å‹*/
    return isValid;
}

//èœå•ç•Œé¢
void showMenu(){
    cout << "â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”"/*16æ ¼*/ << endl;
    cout << "|   -é€šè®¯å½•ç®¡ç†ç³»ç»Ÿ- |" << endl;
    cout << "|    â‘  æ·»åŠ è”ç³»äºº    |" << endl;
    cout << "|    â‘¡ æ˜¾ç¤ºè”ç³»äºº    |" << endl;
    cout << "|    â‘¢ åˆ é™¤è”ç³»äºº    |" << endl;
    cout << "|    â‘£ æŸ¥æ‰¾è”ç³»äºº    |" << endl;
    cout << "|    â‘¤ æ¸…ç©ºè”ç³»äºº    |" << endl;
    cout << "|    â‘¥ é€€å‡ºé€šè®¯å½•    |" << endl;
    cout << "â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”"/*16æ ¼*/ << endl;
}

//è”ç³»äºº ç±»
class Contact{
    private:
        string name;//å§“å
        string gender;//æ€§åˆ«
        string birthday;//ç”Ÿæ—¥
        string phone;//ç”µè¯å·ç 
        string address;//ä½å€
        string shortPho;//çŸ­å·

    public:
        //åˆå§‹åŒ–æ„é€ å‡½æ•°
        Contact():
            name(""), gender(""), birthday(""), phone(""), address(""), shortPho(""){}
        //æ„é€ å‡½æ•°
        Contact(string &n, string &g, string &b, string &p, string &a):
            name(n), gender(g), birthday(b), phone(p), address(a){}

        //getterå‡½æ•°ï¼šè·å–å†…éƒ¨ä¿¡æ¯
        string getName() const {return name;}
        string getGender() const {return gender;}
        string getBir() const {return birthday;}
        string getPho() const {return phone;}
        string getAdr() const {return address;}
        string getSho() const {return shortPho;}

        //è·å¾—å…¨éƒ¨ä¿¡æ¯
        void getFullInfo() const {
            cout << "å§“åï¼š" << name << endl <<
                    "æ€§åˆ«ï¼š" << gender << endl <<
                    "ç”Ÿæ—¥ï¼š" << birthday << endl <<
                    "ç”µè¯ï¼š" << phone << endl <<
                    "ä½å€ï¼š" << address << endl;
        };

        //changeå‡½æ•°ï¼šæ”¹å˜å†…éƒ¨ä¿¡æ¯
        void changeName(string newName){name = newName; cout << "ä¿®æ”¹æˆåŠŸï¼š" << name << endl;}
        void changeGen(string newGender){gender = newGender; cout << "ä¿®æ”¹æˆåŠŸï¼š" << gender << endl;}
        void changeBir(string newBir){birthday = newBir; cout << "ä¿®æ”¹æˆåŠŸï¼š" << birthday << endl;}
        void changePhone(string newPhe){phone = newPhe; cout << "ä¿®æ”¹æˆåŠŸï¼š" << phone << endl;}
        void changeAdr(string newAdr){address = newAdr; cout << "ä¿®æ”¹æˆåŠŸï¼š" << name << endl;}
        void changeSho(string newSho){shortPho = newSho; cout << " ä¿®æ”¹æˆåŠŸï¼š" << shortPho << endl;}
};

//é€šè®¯å½• ç±»
class AddressBook{
    private:
        //Contactç±»å‹çš„æ™ºèƒ½åŠ¨æ€æ•°ç»„ï¼Œå­˜å‚¨è”ç³»äºº
        vector<Contact> contacts;

    public:
        // æä¾› contacts çš„å¼•ç”¨
        vector<Contact>& getContacts() {return contacts;}

        //æä¾›ç§æœ‰æˆå‘˜contactsçš„emptyå‡½æ•°çš„å¤–éƒ¨æ¥å£
        bool empty() const {
            return contacts.empty();
        }

        //æ·»åŠ è”ç³»äºº
        void addContact(){
            string name, birthday, phone, address, gender;
            
            cout << "è¯·è¾“å…¥è”ç³»äººä¿¡æ¯" << endl;
            /*å»æ‰è¾“å…¥ç¼“å†²åŒºçš„ä¸€ä½å­—ç¬¦ï¼ˆå‰é¢é€‰æ‹©åŠŸèƒ½æ—¶ä¼šæœ‰æ¢è¡Œç¬¦ç•™åœ¨ç¼“å†²åŒºï¼‰*/
            cout << "å§“åï¼š";    cin.ignore();    getline(cin, name);

            cout << "æ€§åˆ«ï¼š";    getline(cin, gender);
            //æ€§åˆ«è¾“å…¥åˆ¤æ–­
            if (gender != "ç”·" && gender != "å¥³"){
                cout << "è¾“å…¥æ— æ•ˆï¼Œé»˜è®¤ä¸ºâ€œæœªè®¾ç½®â€" << endl;
                gender = "æœªè®¾ç½®";
            }
            
            cout << "ç”Ÿæ—¥(YYYY-MM-DDæˆ–YYYY/MM/DD): ";    getline(cin, birthday);
            //åå¤éªŒè¯è¾“å…¥ï¼Œæ­£ç¡®æ—¢å¯ç»§ç»­ï¼Œåä¹‹é‡è¯•
            do{     
                cout << "å·ç ï¼š";    getline(cin, phone);
                if (phone.size() == 11) break;
                cout << "è¯·è¾“å…¥åä¸€ä½ç”µè¯å·ç ï¼è¯·é‡è¯•" << endl;        
            } while (true);
            
            cout << "åœ°å€ï¼š";    getline(cin, address);
            /*vectorä¼šåœ¨æœ«å°¾è‡ªåŠ¨å¼€è¾Ÿä¸€ä¸ªå†…å­˜ï¼Œç„¶åè‡ªåŠ¨è°ƒç”¨Contactçš„æ„é€ å‡½æ•°(å› ä¸ºæ­¤å¤„çš„vectoræ˜¯Contactæ•°ç»„)
            å¹¶å°†æ‹¬å·å†…çš„å‚æ•°ä¼ ç»™æ„é€ å‡½æ•°ï¼Œå¹¶å®Œæˆæ„é€ ä¸èµ‹å€¼ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œå¿…é¡»ä¼ è¾“çš„å‚æ•°ä¸€ä¸€å¯¹åº”æ‰èƒ½æˆåŠŸ*/
            contacts.emplace_back(name, gender, birthday, phone, address);
            //è¿™é‡Œæ³¨æ„ï¼å…ˆå°†Contactè”ç³»äººåŠ å…¥contactsä¸­æ‰èƒ½å°†ç¡®ä¿åç»­çš„çŸ­å·æ·»åŠ æˆåŠŸï¼Œå› ä¸ºå¦‚æœæ²¡å­˜å…¥ä¹Ÿå°±æ„å‘³ç€æ— æ³•è°ƒå–å†…éƒ¨çš„å‡½æ•°
            cout << "è¯·é—®æ˜¯éœ€è¦å­˜å‚¨äº²æƒ…çŸ­å·ï¼Œå¦‚æœæœ‰è¯·æŒ‰ 1 ; æ²¡æœ‰è¯·æŒ‰ 2 :";
            string judge;    getline(cin, judge);
            if (stoi(judge) == 1){
                Try_again:/*gotoå‡ºå£,ç®€å•çš„gotoå‡½æ•°å®ç°è¾“å…¥é”™è¯¯æ—¶é‡æ–°è¾“å…¥*/
                string newSho;
                cout << "è¯·è¾“å…¥ï¼š";    getline(cin, newSho);
                
                bool isValid = false;//åˆ¤æ–­çŸ­å·æ˜¯å¦ç¬¦åˆè§„å®š
                try {                                               //tryï¼šç‰¹æ®Šä»£ç å—æ ‡è®°
                    stoi(newSho);//stoiåœ¨é‡åˆ°éæ•°å­—å­—ç¬¦æ—¶å°±ä¼šæŠ›å‡ºå¼‚å¸¸       åœ¨å…¶{å¤§æ‹¬å·}å†…éƒ¨è¿è¡Œçš„ä»£ç ï¼Œç›¸å…³å‡½æ•°ä¼šé€šè¿‡â€˜throwâ€™å…³é”®å­—æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸
                    if (newSho.size() == 3) isValid = true;         //æŠ›å‡ºå¼‚å¸¸åä»£ç å°†ä¼šè¿›å…¥catchéƒ¨åˆ†
                }
                //throwæŠ›å‡ºçš„å¼‚å¸¸ç±»å‹è‹¥ä¸catch()å†…çš„å¼‚å¸¸ç±»å‹ç›¸åŒ¹é…ï¼Œç¨‹åºåˆ™ä¼šè·³è½¬åˆ°æ­¤å¤„
                catch(const invalid_argument&/*æ­¤å¤„çš„å¼‚å¸¸ç±»å‹å°±æ˜¯å¯¹åº”stoiå‡½æ•°æŠ›å‡ºçš„å¼‚å¸¸*/) {
                    isValid = false;
                }/*æ­¤å¤„å¯å†™catch(...)æ¥æ•è·æ‰€æœ‰å¼‚å¸¸ç±»å‹*/

                if (!isValid){
                    //ä¸åˆæ ¼åˆ™è·³å›åˆ°è¾“å…¥éƒ¨åˆ†
                    cout << "è¾“å…¥æœ‰è¯¯(éœ€ä¸º3ä½æ•°å­—),è¯·é‡è¯•ï¼" << endl;
                    goto Try_again;
                }
                contacts.back().changeSho(newSho);//æ·»åŠ çŸ­å·
            }

            cout << "è”ç³»äººæ·»åŠ æˆåŠŸï¼" << endl << endl;
            cout << "æ­£åœ¨è¿”å›ä¸Šçº§èœå•...." << endl;
            system("pause");
            return;
        }

        //è¯¦æƒ…é¡µåŠŸèƒ½é€‰æ‹©
        bool internalFct(vector<Contact> &c, int index){
            int function;//è®°å½•é€‰æ‹©çš„æ•°å­—
            while (true){
                cout << endl;
                cout << "åŠŸèƒ½é€‰æ‹©ï¼š\n" << "1-æ›´æ”¹åå­—   2-æ›´æ”¹æ€§åˆ«   3-æ›´æ”¹ç”Ÿæ—¥   4-æ›´æ”¹ç”µè¯\n"
                    << "5-æ›´æ”¹ä½å€   6-æ·»åŠ æˆ–æ›´æ”¹çŸ­å·   9-åˆ é™¤è¯¥è”ç³»äºº   0-é€€å‡ºè¯¦æƒ…é¡µ\nè¯·é€‰æ‹©: ";
                //åˆ¤æ–­è¾“å…¥æ˜¯å¦åˆæ³•
                if(!(cin >> function)){
                    cout << "è¾“å…¥é”™è¯¯ï¼Œè¯·é‡è¯•" << endl;
                    cin.clear();//æ¸…é™¤é”™è¯¯çŠ¶æ€
                    // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šnumeric_limits<streamsize>::max()
                    // ä½œç”¨ï¼šè·å–è¾“å…¥æµçš„æœ€å¤§å­—ç¬¦å®¹é‡ï¼ˆå¯çœ‹ä½œâ€œæ— é™å¤§â€ï¼‰ï¼Œç¡®ä¿èƒ½æ¸…ç©ºæ‰€æœ‰æ®‹ç•™å­—ç¬¦
                    // ç¬¬äºŒä¸ªå‚æ•°ï¼š'\n'ï¼Œè¡¨ç¤ºé‡åˆ°æ¢è¡Œç¬¦å°±åœæ­¢å¿½ç•¥
                    std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
                    continue;
                };
                //ä¸ºä»€ä¹ˆè¿™é‡Œè¿˜ä¼šæœ‰ä¸ªç›¸åŒçš„ä»£ç ï¼šå¦‚æœç”¨æˆ·è¾“å…¥çš„æ˜¯â€œ3abcâ€ï¼Œæ­¤æ—¶å› ä¸ºç¬¬ä¸€ä¸ª3ä¼šè¢«æˆåŠŸè¯»å–åˆ°functionä¸­ï¼Œ
                //ä½†æ˜¯åç»­çš„'a''b''c''\n'ä¼šæ®‹ç•™åœ¨è¾“å…¥ç¼“å†²åŒºï¼Œè¿™é‡Œå¦‚æœç”¨æ— å‚æ•°çš„ignore()å°±åªä¼šæ¶ˆé™¤ä¸€ä¸ªç¼“å†²åŒºçš„å­—ç¬¦
                //å‰©ä¸‹çš„å­—ç¬¦æ— æ³•æ¶ˆé™¤ï¼Œå°±ä¼šå½±å“åç»­çš„è¾“å…¥ã€‚è¿™é‡Œç”¨å¸¦å‚çš„ignore()å°±èƒ½å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜
                cin.ignore(numeric_limits<streamsize>::max(),'\n');
                //æ ¹æ®ç”¨æˆ·è¾“å…¥æ‰§è¡Œä¸åŒåŠŸèƒ½æ“ä½œ
                switch(function){
                    case 0:{
                        cout << "æ­£åœ¨è¿”å›ä¸Šçº§èœå•...." << endl;
                        system("pause");
                        return false;
                    }
                    case 1:{
                        c[index].changeName(input("è¯·è¾“å…¥æ–°åå­—"));
                        break;
                    }
                    case 2:{
                        c[index].changeGen(input("è¯·è¾“å…¥æ€§åˆ«"));
                        break;
                    }
                    case 3:{
                        BirAgain:
                        string newBir = input("è¯·è¾“å…¥æ–°çš„ç”Ÿæ—¥");
                        if(!isBirthday(newBir)) {cout << "æ ¼å¼é”™è¯¯ï¼Œè¯·é‡è¯•" << endl; goto BirAgain;}
                        c[index].changeBir(newBir);
                        break;
                    }
                    case 4:{
                    PhoAgain:
                        string newPho = input("è¯·è¾“å…¥æ–°ç”µè¯å·ç ");
                        if(!isPhone(newPho)) {cout << "æ ¼å¼é”™è¯¯ï¼Œè¯·é‡è¯•" << endl; goto PhoAgain;}
                        c[index].changePhone(newPho);
                        break;
                    }
                    case 5:{
                        c[index].changeAdr(input("è¯·è¾“å…¥æ–°åœ°å€"));
                        break;
                    }
                    case 6:{
                        ShoAgain:
                        string newSho = input("è¯·è¾“å…¥æ–°çš„çŸ­å·");
                        if(!isShort(newSho)) {cout << "æ ¼å¼é”™è¯¯ï¼Œè¯·é‡è¯•" << endl; goto ShoAgain;}
                        c[index].changeSho(newSho);
                        break;
                    }
                    case 9:{
                        string confirm;
                        cout << "ç¡®å®šè¦åˆ é™¤è”ç³»äººå—ï¼Ÿ(Y/N):";
                        getline(cin, confirm);

                        if(confirm == "Y" || confirm == "y"){
                            contacts.erase(contacts.begin() + index);
                            cout << "è”ç³»äººå·²åˆ é™¤ï¼" << endl;
                            return true;
                        } else {
                            cout << "åˆ é™¤æ“ä½œå·²å–æ¶ˆã€‚" << endl;
                            break;
                        }
                    }
                    default:
                        cout << "æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡è¯•ï¼" << endl;
                };
                if(function != '9' && function != '0'){
                    cout << "å·²å®Œæˆï¼Œè¯·æ‚¨ç»§ç»­é€‰æ‹©" <<endl;
                }
            }
        }

        //åˆ é™¤è”ç³»äºº
        void deleteContact(){
            //å…ˆåˆ¤æ–­vectorå†…éƒ¨æ˜¯å¦æœ‰æˆå‘˜
            if (contacts.empty()){
                cout << "é€šè®¯å½•ä¸ºç©ºï¼Œæ— æ³•åˆ é™¤ï¼" << endl << endl;
                return;
            }

            again1://é€‰æ‹©é‡è¯•é€‰é¡¹å°†ä¼šè·³è½¬åˆ°æ­¤å¤„
            string input;
            cout << "è¯·è¾“å…¥è¦åˆ é™¤çš„è”ç³»äººä¿¡æ¯ï¼ˆå§“å/æ€§åˆ«/ç”Ÿæ—¥/ç”µè¯/ä½å€ï¼‰: ";
            cin.ignore();    getline(cin, input);

            vector<int> Indices;//è¿™é‡Œç”¨äºå­˜å‚¨é¡ºåºçš„åºå·ï¼Œä¸ºäº†åç»­ç»™ç”¨æˆ·æä¾›åˆ é™¤ç›®å½•æ˜¯1,2,3é¡ºåºæ’åˆ—
            vector<int> contactIndices;//è¿™é‡Œç”¨äºå­˜å‚¨ç¬¦åˆæ¡ä»¶çš„è”ç³»äººåœ¨Contactæ•°ç»„é‡Œçš„çœŸå®ç´¢å¼•ï¼ŒåŒæ—¶è®°å½•æ•°é‡

            int cnt, j;//cntè®°å½•çœŸå®ç´¢å¼•ï¼Œjæ„é€ é¡ºåºç´¢å¼•
            //éå†é€šè®¯å½•ï¼Œå¯»æ‰¾æœ‰å…³è”ç³»äºº
            for ( cnt = 0, j = 0; cnt < contacts.size(); cnt++){
                const Contact &c = contacts[cnt];
                if (c.getAdr() == input || c.getBir() == input || c.getGender() == input ||
                    c.getPho() == input || c.getName() == input)
                {
                    ++j;//ç¬¦åˆæ¡ä»¶å­˜å…¥æ‰è‡ªåŠ ï¼Œè¾¾æˆé¡ºåºç´¢å¼•
                    Indices.push_back(j);
                    contactIndices.push_back(cnt);
                }
            }

            int order;
            //æœªæ‰¾åˆ°æ—¶è®©ç”¨æˆ·é€‰æ‹©é‡è¯•æˆ–ç»“æŸ
            if (contactIndices.empty()){
                cout << "æœªæ‰¾åˆ°ç›¸å…³è”ç³»äºº" << endl;
                again2://è¾“å…¥éæœ‰æ•ˆæŒ‡ä»¤è·³åˆ°æ­¤å¤„
                cout << "é‡è¯•è¯·æŒ‰1 | ç»“æŸè¯·æŒ‰2" << endl;
                cin >> order;
                cin.ignore();
                if (order == 2){
                    return;
                }
                else if (order == 1){
                    goto again1;
                }
                else {
                    cout << "è¾“å…¥æ•°å­—æ— æ•ˆï¼Œè¯·é‡è¯•" << endl;
                    goto again2;
                }
            }
                
            cnt = 0;//è®¡æ•°å™¨æ¸…é›¶
            cout << "æ‰¾åˆ° " << contactIndices.size() << " ä¸ªç›¸å…³è”ç³»äººï¼Œè¯·é€‰æ‹©ä½ è¦åˆ é™¤çš„è”ç³»äººï¼ˆè¾“å…¥æ•°å­—,ç”¨ç©ºæ ¼åˆ†éš”ï¼‰ï¼š" << endl;
            for_each (Indices.begin(), Indices.end(), [&/*å¼•ç”¨æ•è·*/](int idx/*Indiceså†…éƒ¨æ•°æ®æ˜¯intå‹*/){
                cout << idx << ": " << endl;// Indices ä¸­å­˜å‚¨çš„æ˜¯åŒ¹é…åˆ°çš„è”ç³»äººçš„åºå·ï¼ˆå¦‚ 1, 2, 3...ï¼‰
                contacts[contactIndices[cnt]].getFullInfo();//å±•ç¤ºç¬¦åˆæ¡ä»¶çš„è”ç³»äººä¿¡æ¯
                ++cnt;
            });

            vector<int> deleteIndices;//è®°å½•è¦åˆ é™¤çš„ç´¢å¼•
            while (true){
                cout << "è¯·è¾“å…¥è¦åˆ é™¤çš„è”ç³»äººåºå·(å¦‚: 1 3): ";
                string choiceStr;
                getline(cin, choiceStr);
                
                stringstream ss(choiceStr);
                int idx, cnt = 0;
                //æŒç»­ä» stringstream å¯¹è±¡ ss ä¸­è¯»å–æ•´æ•°ï¼Œç›´åˆ°è¯»å–å¤±è´¥ï¼ˆæ¯”å¦‚æ²¡æœ‰æ•°æ®äº†ã€æˆ–é‡åˆ°éæ•°å­—å­—ç¬¦ï¼‰ï¼Œå¾ªç¯æ‰åœæ­¢
                while (ss >> idx){
                    auto it = find(Indices.begin(), Indices.end(), idx);//å…ˆåœ¨Indicesæ‰¾å‡ºå¯¹åº”çš„åºå·
                    //æ’é™¤æ‰æœ«å°¾çš„æƒ…å†µ
                    if (it != Indices.end()){
                        //è¿™é‡Œç”¨ç¬¦åˆæƒ…å†µçš„è¿­ä»£å™¨å‡å»é¦–å…ƒç´ è¿­ä»£å™¨ï¼Œè·å¾—çš„æ•°å­—å°±æ˜¯çœŸå®çš„ç´¢å¼•æ•°å­—ï¼ˆå› ä¸ºæ•°ç»„é¦–å…ƒç´ æ˜¯0å¼€å§‹ï¼Œè¿™é‡Œå‡æ‰é¦–å…ƒç´ æ°å¥½ç¬¦åˆï¼‰
                        deleteIndices.push_back(contactIndices[it-Indices.begin()]/*è·å¾—contactIndicesé‡Œçš„çœŸå®ç´¢å¼•*/);//å°†è¦åˆ é™¤çš„ç´¢å¼•æ•°å­—è®°å½•åˆ°deleteæ•°ç»„ä¸­
                        ++cnt;
                    } else {
                        cout << "åºå·" << idx << "æ— æ•ˆï¼Œå·²è·³è¿‡ï¼" << endl;
                    }
                }
                
                if (deleteIndices.empty()){
                    cout << "æœªé€‰æ‹©æœ‰æ•ˆç´¢å¼•ï¼Œåˆ é™¤å¤±è´¥ï¼è¯·é‡è¯•" << endl << endl;
                    continue;
                }
                break;
            }

            sort(deleteIndices.rbegin(), deleteIndices.rend());//é€šè¿‡sortå°†é åçš„åºå·æ”¾åœ¨å‰é¢ï¼Œä»åå¾€å‰åˆ ï¼Œé˜²æ­¢è‡ªåŠ¨è¡¥ä½å¯¼è‡´åç»­åˆ é™¤å‡ºç°é—®é¢˜
            for (int idx: deleteIndices/*è‡ªåŠ¨ä»deleteIndiceså–å€¼èµ‹äºˆidxï¼Œå¹¶ä¸”éå†æ‰€æœ‰å…ƒç´ */){
                contacts.erase(contacts.begin() + idx);//beginé»˜è®¤æŒ‡å‘ç¬¬é›¶ä¸ªï¼ŒåŠ ä¸Šidxæ­£å¥½èƒ½æŒ‡å‘éœ€è¦åˆ é™¤çš„è”ç³»äºº
            }

            cout << "å·²åˆ é™¤æˆåŠŸ " << deleteIndices.size() << " ä¸ªè”ç³»äººï¼" << endl << endl;
            cout << "æ­£åœ¨è¿”å›ä¸Šçº§èœå•...." << endl;
            system("pause");
        }

        //æ˜¾ç¤ºæ‰€æœ‰è”ç³»äºº
        void showAllContacts(){
            while (true){
                int cnt = 0;
                cout << "---------------- è”ç³»äººåˆ—è¡¨ -------------------" << endl;
                for (const Contact& contact: contacts){
                    cout << cnt + 1 << ":" << endl;
                    contact.getName();
                    cout << endl;
                    ++cnt;
                }
                 cout << "--------------------------------------------" << endl;
                
                while (true){
                    TryAgain:
                    bool refresh = false;
                    int choice;
                    cout << "è¯·è¾“å…¥æƒ³æŸ¥çœ‹çš„è”ç³»äººçš„åºå·(ä¸éœ€è¦åˆ™è¾“å…¥0): ";    cin >> choice;
                    if (choice == 0){
                        cout << "æ­£åœ¨è¿”å›ä¸Šçº§ç›®å½•...." << endl;
                        system("pause");
                        return;
                    } else if (choice <= cnt+1 && choice > 0){
                        contacts[choice-1].getFullInfo();
                        refresh =internalFct(contacts,choice-1);
                    } else {
                        cin.clear();
                        cout << "åºå·æ— æ•ˆï¼Œè¯·é‡è¯•ï¼" << endl;
                        goto TryAgain;
                    }

                    if (refresh){
                        cout << "è”ç³»äººå·²åˆ é™¤ï¼Œæ­£åœ¨é‡æ–°åŠ è½½åˆ—è¡¨...." << endl;
                        system("pause");
                        break;
                    }
                }
            }
        }

        //æŸ¥æ‰¾è”ç³»äºº
        void findContact(){
            if (contacts.empty()){
                cout << "é€šè®¯å½•ä¸ºç©ºï¼Œæ— æœå¯»å¯¹è±¡" << endl << endl;
                return;
            }

            string search;
            int idx = 0, cnt = 0;
            vector<int> Indices;
            vector<int> trueIndices;

            cin.ignore();

            while (true){
                cout << "è¯·è¾“å…¥è¦æœå¯»çš„è”ç³»äººçš„ç›¸å…³ä¿¡æ¯ï¼š";
                getline(cin, search);

                vector<int> Indices;
                vector<int> trueIndices;

                for (const Contact &c: contacts){
                    if (c.getAdr() == search || c.getBir() == search || c.getGender() == search ||
                        c.getPho() == search || c.getName() == search)
                    {
                        ++cnt;
                        Indices.push_back(cnt);
                        trueIndices.push_back(idx);
                    }
                    ++idx;
                }

                if (cnt == 0){
                    string ifRestart = input("æ²¡æœ‰æ‰¾åˆ°ç›¸å…³è”ç³»äººï¼Œæ˜¯å¦é‡è¯•(é‡è¯•è¯·æŒ‰1,é€€å‡ºè¯·æŒ‰0): ");
                    if (ifRestart == "1") {cout << endl; continue;}
                    else {cout << "\næ­£åœ¨é€€å‡º...."; return;}
                }
            }

            cout << "å…±æ‰¾åˆ° " << cnt << " ä¸ªç›¸å…³è”ç³»äºº:" << endl;
            cnt = 0;
            for (int printIdx: trueIndices){
                cout << Indices[++cnt] << ": " << endl;
                contacts[printIdx].getName();
            }

            int choice;
            while (true){
                cout << "è¯·è¾“å…¥è¦æŸ¥çœ‹çš„è”ç³»äººåºå·ï¼š";
                cin >> choice;
                cin.ignore();
                if (choice <= 0 || choice > cnt){
                    cout << "è¾“å…¥åºå·æ— æ•ˆï¼Œè¯·é‡è¯•" << endl;
                    continue;
                }
                break;
            }
            contacts[trueIndices[choice]-1].getFullInfo();

            bool refresh;
            string specific = input("æ˜¯å¦éœ€è¦æ›´æ”¹ä¿¡æ¯(æŒ‰1;å¦‚ä¸éœ€åˆ™è¾“å…¥ä»»æ„å­—ç¬¦): ");
            if (specific == "1") {refresh = internalFct(contacts, choice-1);}

            if (refresh){
                cout << "è”ç³»äººå·²åˆ é™¤ï¼Œæ­£åœ¨é‡æ–°åŠ è½½åˆ—è¡¨...." << endl;
                system("pause");
            }
            showAllContacts();
        }

        void clearAllContacts(){
            if (contacts.empty()) {
                cout << "ğŸ“­ é€šè®¯å½•å·²ä¸ºç©ºï¼Œæ— éœ€æ¸…é™¤ï¼" << endl << endl;
                return;
            }

            // 2. å®‰å…¨ç¡®è®¤ï¼šé˜²æ­¢ç”¨æˆ·è¯¯è§¦ï¼Œè®©ç”¨æˆ·è¾“å…¥Y/yç¡®è®¤
            string confirm;
            cout << "âš ï¸  è­¦å‘Šï¼šæ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰è”ç³»äººï¼Œä¸”æ— æ³•æ¢å¤ï¼" << endl;
            cout << "è¯·è¾“å…¥ Y ç¡®è®¤æ¸…é™¤ï¼Œè¾“å…¥å…¶ä»–å­—ç¬¦å–æ¶ˆï¼š";
            
            // å¤„ç†è¾“å…¥ç¼“å†²åŒºæ®‹ç•™ï¼ˆé¿å…ä¹‹å‰çš„æ¢è¡Œç¬¦å½±å“ getlineï¼‰
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            getline(cin, confirm);

            // 3. åˆ¤æ–­ç”¨æˆ·é€‰æ‹©
            if (confirm == "Y" || confirm == "y") {
            // æ ¸å¿ƒæ“ä½œï¼šæ¸…ç©º contacts å®¹å™¨ï¼ˆvector::clear() ä¼šåˆ é™¤æ‰€æœ‰å…ƒç´ ï¼Œé‡Šæ”¾å†…å­˜ï¼‰
                contacts.clear();
                cout << "âœ… æ‰€æœ‰è”ç³»äººå·²æˆåŠŸæ¸…é™¤ï¼" << endl << endl;
                return;
            } else {
                cout << "ğŸš« æ¸…é™¤æ“ä½œå·²å–æ¶ˆï¼Œè”ç³»äººåˆ—è¡¨ä¿æŒä¸å˜ã€‚" << endl << endl;
                return;
            }
        }
    };


int main(void){
    int select = 0;
    int refresh = false;
    AddressBook contacts;

    while (true){

        showMenu();

        cin >> select;
        switch (select)
        {
            case 1://æ·»åŠ è”ç³»äºº
                contacts.addContact();
                break;
            case 2://æ˜¾ç¤ºè”ç³»äºº
                contacts.showAllContacts();
                break;
            case 3://åˆ é™¤è”ç³»äºº
                contacts.deleteContact();
                break;
            case 4://æŸ¥æ‰¾è”ç³»äºº
                contacts.findContact();
                break;
            case 5://æ¸…ç©ºè”ç³»äºº
                contacts.clearAllContacts();
                break;
            case 6://é€€å‡ºé€šè®¯å½•
                cout << "æ¬¢è¿ä¸‹æ¬¡ä½¿ç”¨ï¼Œå†è§ï¼" << endl;
                break;
            default://æœªè¾“å…¥è§„èŒƒæ•°å­—
                cout << "æœªè¾“å…¥è§„èŒƒæ•°å­—ï¼Œè¯·é‡è¯•ï¼š";
                break;
        }
    }

    system("pause");
    return 0;
}
